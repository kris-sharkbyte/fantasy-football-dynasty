<div class="create-league-container">
  <p-card class="create-league-card">
    <ng-template pTemplate="header">
      <div class="text-center py-6">
        <i class="pi pi-trophy text-6xl text-primary-500 mb-4"></i>
        <h1 class="text-3xl font-bold text-secondary-900 mb-2">
          Create New League
        </h1>
        <p class="text-lg text-secondary-600">
          Set up your dynasty fantasy football league step by step
        </p>
      </div>
    </ng-template>

    @if (isLoading()) {
      <div class="text-center py-8">
        <p-progressSpinner></p-progressSpinner>
        <p class="mt-4 text-secondary-600">Loading form...</p>
      </div>
    } @else {
      <!-- Wizard Steps -->
      <p-steps
        [model]="steps"
        [readonly]="false"
        [activeIndex]="currentStepIndex()"
        (activeIndexChange)="onStepChange($event)"
        class="mb-6"
      ></p-steps>

      <!-- Step Content -->
      <form [formGroup]="leagueForm" class="step-content">
        @if (currentStepIndex() === 0) {
        <!-- Step 1: Basic Information -->
        <div class="form-section">
          <h2 class="text-xl font-semibold text-secondary-800 mb-4">
            League Information
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="field">
              <label
                for="name"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                League Name *
              </label>
              <input
                id="name"
                type="text"
                pInputText
                formControlName="name"
                placeholder="Enter league name"
                class="w-full"
              />
              @if (leagueForm.get('name')?.invalid &&
              leagueForm.get('name')?.touched) {
              <small class="p-error">League name is required</small>
              }
            </div>

            <div class="field">
              <label
                for="numberOfTeams"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Number of Teams *
              </label>
              <p-inputNumber
                id="numberOfTeams"
                formControlName="numberOfTeams"
                [min]="2"
                [max]="32"
                [showButtons]="true"
                buttonLayout="horizontal"
                spinnerMode="horizontal"
                [step]="1"
                decrementButtonClass="p-button-secondary"
                incrementButtonClass="p-button-secondary"
                incrementButtonIcon="pi pi-plus"
                decrementButtonIcon="pi pi-minus"
                class="w-full"
              ></p-inputNumber>
              @if (leagueForm.get('numberOfTeams')?.invalid &&
              leagueForm.get('numberOfTeams')?.touched) {
              <small class="p-error"
                >Number of teams must be between 2 and 32</small
              >
              }
            </div>
          </div>

          <div class="field mt-4">
            <label
              for="description"
              class="block text-sm font-medium text-secondary-700 mb-2"
            >
              Description
            </label>
            <textarea
              id="description"
              pInputTextarea
              formControlName="description"
              rows="3"
              placeholder="Describe your league (optional)"
              class="w-full"
            ></textarea>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div class="field">
              <label
                for="scoring"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Scoring System
              </label>
              <div formGroupName="rules">
                <p-select
                  id="scoring"
                  formControlName="scoring"
                  [options]="scoringSystems"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select scoring system"
                  class="w-full"
                ></p-select>
              </div>
            </div>

            <div class="field">
              <label
                for="salaryCap"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Salary Cap ($) *
              </label>
              <div formGroupName="rules">
                <div formGroupName="cap">
                  <p-inputNumber
                    id="salaryCap"
                    formControlName="salaryCap"
                    [min]="100000000"
                    [max]="1000000000"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="10000000"
                    suffix="M"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>
          </div>
        </div>
        } @if (currentStepIndex() === 1) {
        <!-- Step 2: Salary Cap & Contract Settings -->
        <div class="form-section">
          <h2 class="text-xl font-semibold text-secondary-800 mb-4">
            Salary Cap & Contract Settings
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="field">
              <label
                for="minSpend"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Minimum Team Spend ($)
              </label>
              <div formGroupName="rules">
                <div formGroupName="cap">
                  <p-inputNumber
                    id="minSpend"
                    formControlName="minimumSpend"
                    [min]="100000000"
                    [max]="200000000"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="10000000"
                    suffix="M"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>

            <div class="field">
              <label
                for="maxContractYears"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Maximum Contract Years
              </label>
              <div formGroupName="rules">
                <div formGroupName="contracts">
                  <p-inputNumber
                    id="maxContractYears"
                    formControlName="maxYears"
                    [min]="1"
                    [max]="7"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="1"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>

            <div class="field">
              <label
                for="maxSigningBonus"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Max Signing Bonus ($)
              </label>
              <div formGroupName="rules">
                <div formGroupName="contracts">
                  <p-inputNumber
                    id="maxSigningBonus"
                    formControlName="maxSigningBonus"
                    [min]="10000000"
                    [max]="100000000"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="1000000"
                    suffix="M"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>
          </div>

          <div class="field mt-4">
            <div formGroupName="rules">
              <div formGroupName="contracts">
                <div class="flex items-center gap-3">
                  <input
                    type="checkbox"
                    id="rookieScale"
                    formControlName="rookieScale"
                    class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"
                  />
                  <label
                    for="rookieScale"
                    class="text-sm font-medium text-secondary-700"
                  >
                    Use Rookie Scale Contracts
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        } @if (currentStepIndex() === 2) {
        <!-- Step 3: Draft & Roster Settings -->
        <div class="form-section">
          <h2 class="text-xl font-semibold text-secondary-800 mb-4">
            Draft & Roster Settings
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="field">
              <label
                for="draftRounds"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Draft Rounds
              </label>
              <div formGroupName="rules">
                <div formGroupName="draft">
                  <p-inputNumber
                    id="draftRounds"
                    formControlName="rounds"
                    [min]="15"
                    [max]="30"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="1"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>

            <div class="field">
              <label
                for="draftTimeLimit"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Draft Pick Time Limit (seconds)
              </label>
              <div formGroupName="rules">
                <div formGroupName="draft">
                  <p-inputNumber
                    id="draftTimeLimit"
                    formControlName="timeLimit"
                    [min]="30"
                    [max]="300"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="15"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div class="field">
              <label
                for="autodraftDelay"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Auto-draft Delay (seconds)
              </label>
              <div formGroupName="rules">
                <div formGroupName="draft">
                  <p-inputNumber
                    id="autodraftDelay"
                    formControlName="autodraftDelay"
                    [min]="10"
                    [max]="60"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="5"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>

            <div class="field">
              <label
                for="veteranNegotiationWindow"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Veteran Negotiation Window (hours)
              </label>
              <div formGroupName="rules">
                <div formGroupName="draft">
                  <p-inputNumber
                    id="veteranNegotiationWindow"
                    formControlName="veteranNegotiationWindow"
                    [min]="24"
                    [max]="168"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="24"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>
          </div>

          <div class="field mt-4">
            <div formGroupName="rules">
              <div formGroupName="draft">
                <div class="flex items-center gap-3">
                  <input
                    type="checkbox"
                    id="rookieAutoContracts"
                    formControlName="rookieAutoContracts"
                    class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"
                  />
                  <label
                    for="rookieAutoContracts"
                    class="text-sm font-medium text-secondary-700"
                  >
                    Auto-assign Rookie Contracts
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        } @if (currentStepIndex() === 3) {
        <!-- Step 4: Free Agency Settings -->
        <div class="form-section">
          <h2 class="text-xl font-semibold text-secondary-800 mb-4">
            Free Agency Settings
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="field">
              <label
                for="bidRounds"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Bid Round Duration (seconds)
              </label>
              <div formGroupName="rules">
                <div formGroupName="freeAgency">
                  <p-inputNumber
                    id="bidRounds"
                    formControlName="bidRounds"
                    [min]="15"
                    [max]="60"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="5"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>

            <div class="field">
              <label
                for="minimumSpend"
                class="block text-sm font-medium text-secondary-700 mb-2"
              >
                Minimum Team Spend ($)
              </label>
              <div formGroupName="rules">
                <div formGroupName="cap">
                  <p-inputNumber
                    id="minimumSpend"
                    formControlName="minimumSpend"
                    [min]="100000000"
                    [max]="200000000"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    spinnerMode="horizontal"
                    [step]="10000000"
                    suffix="M"
                    decrementButtonClass="p-button-secondary"
                    incrementButtonClass="p-button-secondary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    class="w-full"
                  ></p-inputNumber>
                </div>
              </div>
            </div>
          </div>

          <!-- Privacy Settings -->
          <div class="field mt-6">
            <div class="flex items-center gap-3">
              <input
                type="checkbox"
                id="isPrivate"
                formControlName="isPrivate"
                class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"
              />
              <label
                for="isPrivate"
                class="text-sm font-medium text-secondary-700"
              >
                Make League Private (Requires join code to join)
              </label>
            </div>
            <small class="text-secondary-500 mt-2 block">
              Private leagues can only be joined using the generated join code.
              Public leagues can be discovered through search and joined with the
              code.
            </small>
          </div>
        </div>
        } @if (currentStepIndex() === 4) {
        <!-- Step 5: Review & Create -->
        <div class="form-section">
          <h2 class="text-xl font-semibold text-secondary-800 mb-4">
            Review League Settings
          </h2>

          <div class="review-grid">
            <div class="review-section">
              <h3 class="text-lg font-medium text-secondary-700 mb-3">
                Basic Information
              </h3>
              <div class="review-item">
                <span class="label">League Name:</span>
                <span class="value">{{ leagueForm.get('name')?.value }}</span>
              </div>
              <div class="review-item">
                <span class="label">Number of Teams:</span>
                <span class="value">{{ leagueForm.get('numberOfTeams')?.value }}</span>
              </div>
              <div class="review-item">
                <span class="label">Scoring System:</span>
                <span class="value">{{
                  getScoringLabel(leagueForm.get('rules.scoring')?.value)
                }}</span>
              </div>
            </div>

            <div class="review-section">
              <h3 class="text-lg font-medium text-secondary-700 mb-3">
                Salary Cap Settings
              </h3>
              <div class="review-item">
                <span class="label">Salary Cap:</span>
                <span class="value">${{ (leagueForm.get('rules.cap.salaryCap')?.value / 1000000).toFixed(1) }}M</span>
              </div>
              <div class="review-item">
                <span class="label">Min Spend:</span>
                <span class="value">${{ (leagueForm.get('rules.cap.minimumSpend')?.value / 1000000).toFixed(1) }}M</span>
              </div>
              <div class="review-item">
                <span class="label">Max Contract Years:</span>
                <span class="value">{{
                  leagueForm.get('rules.contracts.maxYears')?.value
                }}</span>
              </div>
            </div>

            <div class="review-section">
              <h3 class="text-lg font-medium text-secondary-700 mb-3">
                Draft & Roster
              </h3>
              <div class="review-item">
                <span class="label">Draft Rounds:</span>
                <span class="value">{{
                  leagueForm.get('rules.draft.rounds')?.value
                }}</span>
              </div>
              <div class="review-item">
                <span class="label">Draft Time Limit:</span>
                <span class="value"
                  >{{ leagueForm.get('rules.draft.timeLimit')?.value }}s</span
                >
              </div>
              <div class="review-item">
                <span class="label">Auto-draft Delay:</span>
                <span class="value">{{
                  leagueForm.get('rules.draft.autodraftDelay')?.value
                }}s</span>
              </div>
            </div>

            <div class="review-section">
              <h3 class="text-lg font-medium text-secondary-700 mb-3">
                Privacy & Access
              </h3>
              <div class="info-item">
                <span class="label">Privacy:</span>
                <span class="value">
                  {{ leagueForm.get('isPrivate')?.value ? 'Private' : 'Public' }}
                  <small class="block text-secondary-500">
                    A 6-character join code will be generated for your league.
                  </small>
                </span>
              </div>
            </div>
          </div>

          <div class="mt-6 p-4 bg-blue-50 rounded-lg">
            <p class="text-blue-800">
              <i class="pi pi-info-circle mr-2"></i>
              Review your settings carefully. You can modify most settings after
              league creation, but some changes may require commissioner approval.
            </p>
          </div>
        </div>
        }
      </form>

      <!-- Navigation Buttons -->
      <ng-template pTemplate="footer">
        <div class="flex gap-3 justify-between">
          <div>
            @if (currentStepIndex() > 0) {
            <p-button
              label="Previous"
              icon="pi pi-chevron-left"
              (onClick)="previousStep()"
              severity="secondary"
              outlined="true"
            ></p-button>
            }
          </div>

          <div class="flex gap-3">
            @if (currentStepIndex() < steps.length - 1) {
            <p-button
              label="Next"
              icon="pi pi-chevron-right"
              iconPos="right"
              (onClick)="nextStep()"
              severity="primary"
              [disabled]="!isCurrentStepValid()"
            ></p-button>
            } @else {
            <p-button
              label="Create League"
              icon="pi pi-check"
              (onClick)="onSubmit()"
              severity="success"
              [loading]="isSubmitting()"
              [disabled]="!leagueForm.valid"
            ></p-button>
            }

            <p-button
              label="Cancel"
              icon="pi pi-times"
              routerLink="/leagues"
              severity="secondary"
              outlined="true"
            ></p-button>
          </div>
        </div>
      </ng-template>
    }
  </p-card>
</div>
