<div class="my-roster-container">
  <!-- Header -->
  <div class="roster-header">
    <h1>My Roster</h1>
    <p class="league-info">
      @if (league()) {
      {{ league()?.name }}
      }
    </p>
    <div class="header-actions">
      <p-button
        label="Back to League"
        icon="pi pi-arrow-left"
        severity="secondary"
        [routerLink]="['/leagues', leagueId()]"
      ></p-button>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <p-progressSpinner></p-progressSpinner>
    <p>Loading your roster...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-container">
    <p-message severity="error" [text]="error()!"></p-message>
    <p-button
      label="Try Again"
      icon="pi pi-refresh"
      (onClick)="ngOnInit()"
      class="mt-3"
    ></p-button>
  </div>
  }

  <!-- Roster Content -->
  @if (!isLoading() && !error() && myMember()) {
  <div class="roster-content">
    <!-- Team Info -->
    <p-card class="team-info-card">
      <ng-template pTemplate="header">
        <div class="team-header">
          <h2>{{ myMember()?.teamName }}</h2>
          <div class="team-stats">
            <span class="stat">
              <strong>Cap Space:</strong> ${{
                (myMember()?.capSpace || 0) / 1000000 | number : '1.1-1'
              }}M
            </span>
            <span class="stat">
              <strong>Players:</strong> {{ rosterWithPlayers().length }}
            </span>
          </div>
        </div>
      </ng-template>
    </p-card>

    <!-- Roster Table -->
    @if (rosterWithPlayers().length > 0) {
    <p-card class="roster-table-card">
      <ng-template pTemplate="header">
        <h3>Roster</h3>
      </ng-template>

      <p-table
        [value]="rosterWithPlayers()"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Player</th>
            <th>Position</th>
            <th>Team</th>
            <th>Age</th>
            <th>Experience</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rosterSlot>
          <tr>
            <td>
              <div class="player-info">
                <strong>{{ rosterSlot.playerName }}</strong>
                @if (rosterSlot.player?.search_rank) {
                <small class="search-rank"
                  >#{{ rosterSlot.player.search_rank }}</small
                >
                }
              </div>
            </td>
            <td>
              <p-tag
                [value]="getPositionDisplayName(rosterSlot.position)"
                [severity]="
                  rosterSlot.position === 'QB'
                    ? 'danger'
                    : rosterSlot.position === 'RB'
                    ? 'warning'
                    : rosterSlot.position === 'WR'
                    ? 'info'
                    : rosterSlot.position === 'TE'
                    ? 'success'
                    : 'secondary'
                "
              ></p-tag>
            </td>
            <td>{{ rosterSlot.team }}</td>
            <td>{{ rosterSlot.age }}</td>
            <td>{{ rosterSlot.yearsExp }} years</td>
            <td>
              <p-tag
                [value]="getStatusDisplayName(rosterSlot.status)"
                [severity]="getStatusSeverity(rosterSlot.status)"
              ></p-tag>
            </td>
            <td>
              <div class="actions">
                @if (rosterSlot.player) {
                <p-button
                  label="Create Contract"
                  icon="pi pi-file-edit"
                  size="small"
                  severity="primary"
                  (onClick)="openContractModal(rosterSlot.player)"
                ></p-button>
                }
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
    } @else {
    <p-card class="empty-roster-card">
      <ng-template pTemplate="body">
        <div class="empty-state">
          <i class="pi pi-users" style="font-size: 3rem; color: #ccc"></i>
          <h3>No Players on Roster</h3>
          <p>
            Your roster is empty. Complete the draft simulation to add players.
          </p>
          <p-button
            label="Go to League Settings"
            icon="pi pi-cog"
            [routerLink]="['/leagues', leagueId()]"
          ></p-button>
        </div>
      </ng-template>
    </p-card>
    }
  </div>
  }

  <!-- Contract Creation Modal -->
  <p-dialog
    [(visible)]="showContractModal"
    header="Create Contract"
    [modal]="true"
    [style]="{ width: '50rem' }"
    [draggable]="false"
    [resizable]="false"
  >
    @if (selectedPlayer()) {
    <div class="contract-form">
      <div class="player-summary">
        <h3>
          {{ selectedPlayer()?.first_name }} {{ selectedPlayer()?.last_name }}
        </h3>
        <p>
          {{ selectedPlayer()?.position }} • {{ selectedPlayer()?.team }} • Age
          {{ selectedPlayer()?.age }}
        </p>
      </div>

      <div class="contract-details">
        <div class="contract-header">
          <h4>Contract Management</h4>
          <p-button
            label="Create Contract"
            icon="pi pi-plus"
            severity="success"
            size="small"
            (onClick)="openContractCreationModal(selectedPlayer()!)"
          ></p-button>
        </div>
        <div class="contract-info">
          <p>
            <strong>Player:</strong> {{ selectedPlayer()?.first_name }}
            {{ selectedPlayer()?.last_name }}
          </p>
          <p><strong>Position:</strong> {{ selectedPlayer()?.position }}</p>
          <p><strong>Age:</strong> {{ selectedPlayer()?.age }}</p>
          <p>
            <strong>Experience:</strong> {{ selectedPlayer()?.years_exp }} years
          </p>
          <p>
            <strong>Team:</strong> {{ selectedPlayer()?.team || 'Free Agent' }}
          </p>
        </div>
      </div>
    </div>
    }

    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        severity="secondary"
        (onClick)="closeContractModal()"
      ></p-button>
      <p-button
        label="Create Contract"
        icon="pi pi-check"
        severity="success"
        (onClick)="closeContractModal()"
      ></p-button>
    </ng-template>
  </p-dialog>

  <!-- Contract Creation Modal -->
  <p-dialog
    [(visible)]="showContractCreationModal"
    [modal]="true"
    [style]="{ width: '90vw', maxWidth: '800px' }"
    [draggable]="false"
    [resizable]="false"
    header="Create Contract"
  >
    <app-contract-creation
      *ngIf="selectedPlayerForContract"
      [playerId]="selectedPlayerForContract.player_id"
      [teamId]="myMember()?.teamId || ''"
      [salaryCap]="salaryCap"
      [existingContracts]="existingContracts"
      [onSuccess]="onContractCreated"
      [onCancel]="onContractCancelled"
    ></app-contract-creation>
  </p-dialog>
</div>
