<div
  class="contract-creation"
  [class.theme-dark]="isDarkMode()"
  [class.theme-light]="!isDarkMode()"
>
  <div class="contract-layout">
    <!-- Left Column - Player Profile & Contract Inputs -->
    <div class="left-column">
      <!-- Player Profile Section -->
      <div class="player-profile">
        <div class="player-header">
          <div class="player-photo">
            <div class="photo-placeholder">
              <i class="pi pi-user"></i>
            </div>
            <div class="nflpa-badge">
              <i class="pi pi-shield"></i>
            </div>
          </div>
          <div class="player-info">
            <h2 class="player-name">{{ getPlayerName() }}</h2>
            <div class="player-details">
              <span class="position-number"
                >#{{ getPlayerData()?.number || '00' }}
                {{ getPlayerData()?.position }}</span
              >
              <span class="age-college"
                >AGE: {{ getPlayerData()?.age }}, COLLEGE:
                {{ getPlayerData()?.college || 'Unknown' }}</span
              >
            </div>
            <div class="player-rating">
              <div class="rating-icon">
                <i class="pi pi-star"></i>
              </div>
              <div class="rating-value">{{ playerRating() }} OVR</div>
            </div>
          </div>
        </div>

        <div class="expected-value">
          <div class="value-label">EXPECTED VALUE</div>
          <div class="value-amount">
            {{ numberFormatService.formatCurrency(getExpectedValue()) }} /
            {{ contractData.years }} YEAR
          </div>
          <div class="value-apy">
            {{ numberFormatService.formatCurrency(getExpectedValue()) }} PER
            YEAR
          </div>
        </div>

        <div class="player-tags">
          <span class="tag-label">TAGS:</span>
          <span class="tag-value">{{ getPlayerTag() }}</span>
          <button class="scheme-fit-btn">
            <i class="pi pi-puzzle-piece"></i>
            SCHEME FIT
          </button>
        </div>
      </div>

      <!-- Offer Status Section -->
      <div class="offer-status">
        <div class="risk-bar">
          <div
            class="risk-indicator"
            [style.width.%]="getRiskPercentage()"
          ></div>
        </div>
        <div class="risk-label">NEUTRAL</div>
        <div class="risk-level">MEDIUM RISK</div>
        <div class="risk-details">
          <div class="risk-point positive">+ Close to market value</div>
          <div class="risk-point negative">- The player may not accept</div>
        </div>
      </div>

      <!-- Contract Inputs Section -->
      <div class="contract-inputs">
        <div class="input-group">
          <label for="years">Years</label>
          <select
            id="years"
            [(ngModel)]="contractData.years"
            (change)="updateBaseSalaryYears()"
            class="form-control"
          >
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>

        <div class="input-group">
          <label for="salary">Salary</label>
          <input
            type="text"
            id="salary"
            [value]="formattedSalary"
            (input)="onSalaryInputChange($any($event.target).value)"
            placeholder="0"
            class="form-control"
          />
        </div>

        <div class="input-group">
          <label for="bonus">Bonus</label>
          <input
            type="text"
            id="bonus"
            [value]="formattedBonus"
            (input)="onBonusInputChange($any($event.target).value)"
            placeholder="0"
            class="form-control"
          />
        </div>
      </div>

      <!-- Negotiation Panel -->
      <div class="negotiation-panel" *ngIf="!isNegotiating()">
        <div class="panel-header">
          <h3>NEGOTIATION</h3>
          <button class="start-negotiation-btn" (click)="startNegotiation()">
            START NEGOTIATION
          </button>
        </div>
        <div class="panel-content">
          <p>
            Click "START NEGOTIATION" to begin contract talks with this player's
            agent.
          </p>
        </div>
      </div>

      <div class="negotiation-panel active" *ngIf="isNegotiating()">
        <div class="panel-header">
          <h3>NEGOTIATION ACTIVE</h3>
          <div class="negotiation-status">
            <span class="round">Round {{ currentRound() }}</span>
            <span class="patience">Patience: {{ remainingPatience() }}</span>
          </div>
        </div>

        <div class="player-demands">
          <div class="demand-item">
            <span class="demand-label">Reservation (Min):</span>
            <span class="demand-value"
              >{{
                numberFormatService.formatCurrency(
                  getPlayerReservation()?.aav || 0
                )
              }}/yr</span
            >
          </div>
          <div class="demand-item">
            <span class="demand-label">Ask Anchor:</span>
            <span class="demand-value"
              >{{
                numberFormatService.formatCurrency(
                  getPlayerAskAnchor()?.aav || 0
                )
              }}/yr</span
            >
          </div>
          <div class="demand-item">
            <span class="demand-label">Guarantees:</span>
            <span class="demand-value">{{
              numberFormatService.formatPercentage(
                getPlayerReservation()?.gtdPct || 0
              )
            }}</span>
          </div>
        </div>

        <div class="negotiation-actions">
          <button
            class="submit-offer-btn"
            (click)="submitOffer()"
            [disabled]="!isFormValid()"
          >
            SUBMIT OFFER
          </button>
          <button class="end-negotiation-btn" (click)="endNegotiation()">
            END TALKS
          </button>
        </div>

        <div
          class="negotiation-history"
          *ngIf="negotiationHistory().length > 0"
        >
          <h4>Negotiation History</h4>
          <div
            class="history-item"
            *ngFor="let item of negotiationHistory(); let i = index"
          >
            <div class="history-type" [class]="item.type">
              {{ item.type.toUpperCase() }}
            </div>
            <div class="history-details">
              <span
                >{{
                  numberFormatService.formatCurrency(item.offer.aav)
                }}/yr</span
              >
              <span
                >{{
                  numberFormatService.formatPercentage(item.offer.gtdPct)
                }}
                gtd</span
              >
              <span>{{ item.offer.years }} years</span>
            </div>
            <div class="history-message" *ngIf="item.message">
              {{ item.message }}
            </div>
          </div>
        </div>
      </div>

      <!-- Make Offer Button -->
      <button
        class="make-offer-btn"
        [disabled]="!isFormValid()"
        (click)="createContract()"
      >
        MAKE OFFER
      </button>
    </div>

    <!-- Right Column - Team & Analysis -->
    <div class="right-column">
      <!-- Team Position Depth -->
      <div class="team-depth">
        <div class="section-header">
          <div class="team-logo">
            <i class="pi pi-home"></i>
          </div>
          <h3>TEAM POSITION DEPTH</h3>
        </div>
        <div class="depth-list">
          <div
            class="depth-item"
            *ngFor="let player of getTeamDepth(); let i = index"
          >
            <div class="depth-rating">{{ player.overall }} OVR</div>
            <div class="depth-number">
              #{{ player.number }} {{ player.position }}
            </div>
            <div class="depth-age">AGE: {{ player.age }}</div>
          </div>
        </div>
      </div>

      <!-- Offer Breakdown -->
      <div class="offer-breakdown">
        <div class="cap-space">
          REMAINING CAP:
          {{ numberFormatService.formatCurrency(getRemainingCap()) }}
        </div>
        <h3>OFFER BREAKDOWN</h3>
        <div class="breakdown-table">
          <div class="table-header">
            <span>YEAR</span>
            <span>SALARY</span>
            <span>CAP HIT</span>
          </div>
          <div
            class="table-row"
            *ngFor="let year of getContractYears(); track: year"
          >
            <span>{{ 2023 + year - 1 }}</span>
            <span>{{
              numberFormatService.formatCurrency(
                contractData.baseSalary[year] || 0
              )
            }}</span>
            <span>{{
              numberFormatService.formatCurrency(getCapHit(year))
            }}</span>
          </div>
          <div class="table-row total">
            <span>Total</span>
            <span>{{
              numberFormatService.formatCurrency(getTotalValue())
            }}</span>
            <span>{{
              numberFormatService.formatCurrency(getTotalCapHit())
            }}</span>
          </div>
        </div>
      </div>

      <!-- Player Motivations -->
      <div class="player-motivations">
        <div class="section-header">
          <h3>PLAYER MOTIVATIONS</h3>
          <span class="impact-label">IMPACT</span>
        </div>
        <div
          class="motivation-item"
          *ngFor="let motivation of getPlayerMotivations(); let i = index"
        >
          <div class="motivation-text">
            <div class="motivation-title">{{ motivation.title }}</div>
            <div class="motivation-detail">{{ motivation.detail }}</div>
          </div>
          <div class="motivation-bar" [class]="motivation.impact"></div>
        </div>
      </div>

      <!-- Interest Level -->
      <div class="interest-level">
        <h3>INTEREST IN YOUR TEAM</h3>
        <div class="interest-container">
          <span class="interest-label">INTEREST LEVEL</span>
          <div class="interest-bar" [class]="getInterestLevel()"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Validation Display (Hidden by default, shown on errors) -->
  <div
    class="validation-section"
    *ngIf="
      contractValidation() &&
      (contractValidation().errors.length > 0 ||
        contractValidation().warnings.length > 0)
    "
  >
    <div
      class="validation-errors"
      *ngIf="contractValidation().errors.length > 0"
    >
      <h4>Contract Issues</h4>
      <ul>
        <li *ngFor="let error of contractValidation().errors">{{ error }}</li>
      </ul>
    </div>
    <div
      class="validation-warnings"
      *ngIf="contractValidation().warnings.length > 0"
    >
      <h4>Warnings</h4>
      <ul>
        <li *ngFor="let warning of contractValidation().warnings">
          {{ warning }}
        </li>
      </ul>
    </div>
  </div>
</div>
