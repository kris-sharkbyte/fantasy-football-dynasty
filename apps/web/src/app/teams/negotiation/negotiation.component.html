<div
  class="negotiation-page"
  [class.theme-dark]="isDarkMode()"
  [class.theme-light]="!isDarkMode()"
>
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading()">
    <p-progressSpinner></p-progressSpinner>
    <p>Loading negotiation...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error() && !isLoading()">
    <p-message severity="error" [text]="error() || ''"></p-message>
    <button
      pButton
      label="Go Back"
      (click)="goBack()"
      class="p-button-secondary"
    ></button>
  </div>

  <!-- Main Content -->
  <div class="negotiation-content" *ngIf="!isLoading() && !error()">
    <!-- Header -->
    <div class="page-header">
      <button
        pButton
        icon="pi pi-arrow-left"
        (click)="goBack()"
        class="p-button-text"
      ></button>
      <h1>Contract Negotiation</h1>
      <div class="player-info">
        <span class="player-name"
          >{{ getPlayerData()?.FirstName }}
          {{ getPlayerData()?.LastName }}</span
        >
        <span class="player-position"
          >{{ getPlayerData()?.Position }} #{{ getPlayerData()?.Number }}</span
        >
      </div>
    </div>

    <div class="negotiation-layout">
      <!-- Left Column - Player Profile & Contract Inputs -->
      <div class="left-column">
        <!-- Player Profile Component -->
        <!-- <app-player-profile
          [player]="getPlayerData()"
          [playerRating]="playerRating()"
          [expectedValue]="getExpectedValue()"
          [contractYears]="contractData.years"
          [playerTag]="getPlayerTag()"
        ></app-player-profile> -->

        <!-- Offer Status Component -->
        <app-offer-status
          [riskPercentage]="getRiskPercentage()"
        ></app-offer-status>

        <!-- Contract Inputs Component -->
        <app-contract-inputs
          [years]="contractData.years"
          [baseSalary]="contractData.baseSalary[1] || 0"
          [signingBonus]="contractData.signingBonus"
          [guarantees]="contractData.guarantees"
          [mode]="'yearly'"
          (yearsChange)="onYearsChange($event)"
          (baseSalaryChange)="onBaseSalaryChange($event)"
          (signingBonusChange)="onSigningBonusChange($event)"
          (guaranteesChange)="onGuaranteesChange($event)"
        ></app-contract-inputs>

        <!-- Negotiation Panel Component -->
        <app-negotiation-panel
          [isNegotiating]="isNegotiating()"
          [currentRound]="currentRound()"
          [remainingPatience]="remainingPatience()"
          [negotiationHistory]="negotiationHistory()"
          [currentSession]="currentSession()"
          [isFormValid]="isFormValid()"
          (startNegotiationClicked)="startNegotiation()"
          (submitOfferClicked)="submitOffer()"
          (endNegotiationClicked)="endNegotiation()"
        ></app-negotiation-panel>
      </div>

      <!-- Right Column - Team & Analysis -->
      <div class="right-column">
        <!-- Team Analysis Component -->
        <app-team-analysis
          [teamDepth]="getTeamDepth()"
          [remainingCap]="getRemainingCap()"
          [contractYears]="getContractYears()"
          [baseSalary]="contractData.baseSalary"
          [signingBonus]="contractData.signingBonus"
          [playerMotivations]="getPlayerMotivations()"
          [interestLevel]="getInterestLevel()"
        ></app-team-analysis>
      </div>
    </div>

    <!-- Validation Display -->
    <div
      class="validation-section"
      *ngIf="
        contractValidation() &&
        (contractValidation().errors.length > 0 ||
          contractValidation().warnings.length > 0)
      "
    >
      <div
        class="validation-errors"
        *ngIf="contractValidation().errors.length > 0"
      >
        <h4>Contract Issues</h4>
        <ul>
          <li *ngFor="let error of contractValidation().errors">{{ error }}</li>
        </ul>
      </div>
      <div
        class="validation-warnings"
        *ngIf="contractValidation().warnings.length > 0"
      >
        <h4>Warnings</h4>
        <ul>
          <li *ngFor="let warning of contractValidation().warnings">
            {{ warning }}
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
